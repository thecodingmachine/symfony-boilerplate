(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{109:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return m})),n.d(t,"default",(function(){return s}));var a=n(3),o=n(7),r=(n(0),n(137)),i={title:"Forms",slug:"/validation/forms"},l={unversionedId:"10_Validation/5_Forms",id:"10_Validation/5_Forms",isDocsHomePage:!1,title:"Forms",description:"In the previous chapters, we saw how to centralize the validation in the API.",source:"@site/docs/10_Validation/5_Forms.md",slug:"/validation/forms",permalink:"/symfony-boilerplate/docs/validation/forms",editUrl:"https://github.com/thecodingmachine/symfony-boilerplate/tree/master/docs/docs/10_Validation/5_Forms.md",version:"current",sidebar:"docs",previous:{title:"GraphQL",permalink:"/symfony-boilerplate/docs/validation/graphql"},next:{title:"Overview",permalink:"/symfony-boilerplate/docs/lists"}},m=[{value:"Browser Validation",id:"browser-validation",children:[]},{value:"API Validation",id:"api-validation",children:[]},{value:"Loading State",id:"loading-state",children:[]}],c={toc:m};function s(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"In the previous chapters, we saw how to centralize the validation in the API.\nThe next step is to integrate this validation mechanism with the web application."),Object(r.b)("p",null,"Let's see how to do that! \ud83d\ude0a"),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","The Symfony Boilerplate uses ",Object(r.b)("a",{parentName:"p",href:"https://bootstrap-vue.org/"},"BootstrapVue")," as templating framework.\nHowever, most of the explanations from this chapter should work with most frameworks with little adjustments."))),Object(r.b)("h2",{id:"browser-validation"},"Browser Validation"),Object(r.b)("p",null,"Event if most of the validation occurs in the API, there are some rules that are better to validate directly in the\nbrowser."),Object(r.b)("p",null,"For instance:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-html",metastring:'title="Vue component <template> block"',title:'"Vue',component:!0,"<template>":!0,'block"':!0},'<b-form-input\n  type="text"\n  autofocus\n  trim\n  required\n/>\n')),Object(r.b)("p",null,"Here there are three rules:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"The browser focuses this input first (UI logic)."),Object(r.b)("li",{parentName:"ol"},"The browser trims the input's content."),Object(r.b)("li",{parentName:"ol"},"The browser does not allow to submit the form until this input has content.")),Object(r.b)("p",null,"Most of the time, that's all you have to do on the browser side."),Object(r.b)("h2",{id:"api-validation"},"API Validation"),Object(r.b)("p",null,"The Symfony Boilerplate provides the ",Object(r.b)("inlineCode",{parentName:"p"},"Form")," mixin. This mixin brings everything you need for integrating\nthe API validation in your UI."),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","A mixin content merges with the content of your Vue component."))),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="Vue component <script> block"',title:'"Vue',component:!0,"<script>":!0,'block"':!0},"import { Form } from '@/mixins/form'\n\nexport default {\n  mixins: [Form],\n}\n")),Object(r.b)("p",null,"Most of the logic occurs in the ",Object(r.b)("inlineCode",{parentName:"p"},"onSubmit")," method from your component:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="Vue component <script> block"',title:'"Vue',component:!0,"<script>":!0,'block"':!0},"import { Form } from '@/mixins/form'\nimport { UpdateEmailMutation } from '@/graphql/examples/update_email.mutation'\n\nexport default {\n  mixins: [Form],\n  data() {\n    return {\n      form: {\n        email: '',\n      },\n    }\n  },\n  methods: {\n    async onSubmit() {\n      // We reset the form errors on submit.\n      // This method comes from the Form mixin.\n      this.resetFormErrors()\n\n      try {\n        const result = await this.$graphql.request(UpdateEmailMutation, {\n          email: this.form.email\n        })\n\n        // Your UI logic on success.\n        // ...\n      } catch (e) {\n        // If the API returns an error response (400 HTTP code),\n        // we hydrate the Form mixin with its content. \n        // This method comes from the Form mixin.\n        this.hydrateFormErrors(e)\n      }\n    },\n  },\n}\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","If the error response is not about validation (i.e., 400 HTTP code), the ",Object(r.b)("inlineCode",{parentName:"p"},"hydrateFromErrors")," method\nthrows the error back. The ",Object(r.b)("em",{parentName:"p"},"src/webapp/layouts/error.vue")," component will then catch it. "))),Object(r.b)("p",null,"Now, we have to display the validation errors to the user. Thanks to ",Object(r.b)("a",{parentName:"p",href:"https://bootstrap-vue.org/"},"BootstrapVue")," and\nthe ",Object(r.b)("inlineCode",{parentName:"p"},"Form")," mixin, it can be done quite easily:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-html",metastring:'title="Vue component <template> block"',title:'"Vue',component:!0,"<template>":!0,'block"':!0},'<b-form @submit.stop.prevent="onSubmit">\n  <b-form-group\n    id="input-group-email"\n    :label="$t(\'common.email.label_required\')"\n    label-for="input-email"\n  >\n    <b-form-input\n      id="input-email"\n      v-model="form.email"\n      type="text"\n      :placeholder="$t(\'common.email.placeholder\')"\n      autofocus\n      trim\n      required\n      :state="formState(\'email\')"\n    />\n    <b-form-invalid-feedback :state="formState(\'email\')">\n      <ErrorsList :errors="formErrors(\'email\')" />\n    </b-form-invalid-feedback>\n  </b-form-group>\n  <b-button type="submit" variant="primary">\n    {{ $t(\'common.submit\') }}\n  </b-button>\n</b-form>\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'<b-form @submit.stop.prevent="onSubmit">')," binds the ",Object(r.b)("inlineCode",{parentName:"li"},"onSubmit")," method to this form."),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("inlineCode",{parentName:"li"},":state")," attribute from the ",Object(r.b)("inlineCode",{parentName:"li"},"<b-form-input>")," component displays the input in red in case of error."),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("inlineCode",{parentName:"li"},"<b-form-invalid-feedback>")," component also uses the ",Object(r.b)("inlineCode",{parentName:"li"},":state")," attribute. It works like a ",Object(r.b)("inlineCode",{parentName:"li"},"v-if")," to display or not\na list of errors related to the previous input."),Object(r.b)("li",{parentName:"ul"},"The Symfony Boilerplate provides the ",Object(r.b)("inlineCode",{parentName:"li"},"<ErrorsList>")," component."),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("inlineCode",{parentName:"li"},"formState")," method returns the current state of a given GraphQL key (see below for more details)."),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("inlineCode",{parentName:"li"},"formErrors")," method returns the list of errors of a given GraphQL key (see below for more details)."),Object(r.b)("li",{parentName:"ul"},"Both ",Object(r.b)("inlineCode",{parentName:"li"},"formState")," and ",Object(r.b)("inlineCode",{parentName:"li"},"formErrors")," methods come from the ",Object(r.b)("inlineCode",{parentName:"li"},"Form")," mixin.")),Object(r.b)("p",null,"A GraphQL key is either:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The GraphQL field name if ",Object(r.b)("inlineCode",{parentName:"li"},"InvalidModel"),"."),Object(r.b)("li",{parentName:"ul"},"The upload's directory name if ",Object(r.b)("inlineCode",{parentName:"li"},"InvalidStorable"),"."),Object(r.b)("li",{parentName:"ul"},"The PHP argument name if it's a ",Object(r.b)("a",{parentName:"li",href:"https://graphqlite.thecodingmachine.io/"},"GraphQLite")," annotation.")),Object(r.b)("h2",{id:"loading-state"},"Loading State"),Object(r.b)("p",null,"Most of the time, you want to display a loader or make your form read-only when the user is submitting the form."),Object(r.b)("p",null,"The Symfony Boilerplate provides the ",Object(r.b)("inlineCode",{parentName:"p"},"GlobalOverlay")," mixin for that task:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="Vue component <script> block"',title:'"Vue',component:!0,"<script>":!0,'block"':!0},"import { GlobalOverlay } from '@/mixins/global-overlay'\nimport { Form } from '@/mixins/form'\nimport { UpdateEmailMutation } from '@/graphql/examples/update_email.mutation'\n\nexport default {\n  mixins: [Form, GlobalOverlay],\n  data() {\n    return {\n      form: {\n        email: '',\n      },\n    }\n  },\n  methods: {\n    async onSubmit() {\n      this.resetFormErrors()\n      // Displays the full page loader.\n      // This method comes from the GlobalOverlay mixin.\n      this.displayGlobalOverlay()\n\n      try {\n        const result = await this.$graphql.request(UpdateEmailMutation, {\n          email: this.form.email\n        })\n\n        // Your UI logic on success.\n        // ...\n      } catch (e) {\n        this.hydrateFormErrors(e)\n      } finally {\n        // Hides the full page loader.\n        // This method comes from the GlobalOverlay mixin.\n        this.hideGlobalOverlay()\n      }\n    },\n  },\n}\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","All layouts from the Symfony Boilerplate works with this mixin. If you add a custom layout, make sure\nit integrates well with the ",Object(r.b)("inlineCode",{parentName:"p"},"GlobalOverlay")," mixin."))))}s.isMDXComponent=!0},137:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return u}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=o.a.createContext({}),s=function(e){var t=o.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=s(e.components);return o.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,c=m(e,["components","mdxType","originalType","parentName"]),p=s(n),d=a,u=p["".concat(i,".").concat(d)]||p[d]||b[d]||r;return n?o.a.createElement(u,l(l({ref:t},c),{},{components:n})):o.a.createElement(u,l({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var m in t)hasOwnProperty.call(t,m)&&(l[m]=t[m]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);